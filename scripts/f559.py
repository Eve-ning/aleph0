import numpy as np

from aleph.consts import *
from reamber.algorithms.generate.sv.SvPkg import SvPkg
from reamber.algorithms.generate.sv.SvSequence import SvSequence
from reamber.osu.OsuBpm import OsuBpm, MIN_BPM
from reamber.osu.OsuMap import OsuMap
from reamber.osu.lists.notes.OsuHitList import OsuHitList

# 03:22:782 () -

offsets = OsuHitList.readEditorString("03:41:022 (221022|0,221022|3,221022|2,221142|1,221262|1,221382|0,221382|2,"
                                      "221382|3,221502|1,221622|2,221742|2,221742|3,221742|0,221742|1,222702|1,"
                                      "222702|0,222702|3,222702|2,222942|0,222942|3,222942|2,223062|2,223062|3,"
                                      "223062|0,223182|1,223302|0,223302|2,223302|3,223422|1,223542|2,223662|2,"
                                      "223662|3,223662|0,223662|1,224142|2,224142|0,224142|3,224142|1,224262|1,"
                                      "224382|2,224502|0,224502|1,224502|3,224622|2,224742|1,224862|2,224862|0,"
                                      "224862|3,224982|1,225102|1,225222|2,225222|3,225222|0,225342|1,225462|2,"
                                      "225582|2,225582|3,225582|0,225582|1,226542|1,226542|0,226542|3,226542|2,"
                                      "226782|0,226782|3,226782|2,226902|2,226902|3,226902|0,227022|1,227142|0,"
                                      "227142|2,227142|3,227262|1,227382|2,227502|2,227502|3,227502|1,227502|0,"
                                      "227982|2,227982|0,227982|3,227982|1,228102|1,228222|2,228342|0,228342|1,"
                                      "228342|3,228462|2,228582|3,228702|1,228702|0,228702|2,228822|3,228942|3,"
                                      "229062|2,229062|1,229062|0,229182|3,229302|0,229422|0,229422|1,229422|2,"
                                      "229422|3,230382|3,230382|2,230382|1,230382|0,230622|1,230622|2,230622|0,"
                                      "230742|0,230742|2,230742|1,230862|3,230982|2,230982|1,230982|0,231102|3,"
                                      "231222|0,231342|1,231342|0,231342|2,231342|3,231822|3,231822|1,231822|2,"
                                      "231822|0,231942|1,232062|2,232182|3,232182|1,232182|0,232302|2,232422|3,"
                                      "232542|2,232542|0,232542|1,232662|3,232782|3,232902|0,232902|1,232902|2,"
                                      "233022|3,233142|0,233262|2,233262|3,233262|0,233262|1,234222|1,234222|0,"
                                      "234222|3,234222|2,234462|0,234462|2,234462|1,234582|1,234582|2,234582|0,"
                                      "234702|3,234822|0,234822|1,234822|2,234942|3,235062|0,235182|2,235182|3,"
                                      "235182|1,235182|0,235662|2,235662|0,235662|3,235662|1,235782|1,235902|2,"
                                      "236022|0,236022|1,236022|3,236142|2,236262|3,236382|2,236382|1,236382|0) - ")\
    .offsets()

offsets = np.unique(offsets)


def f559(m: OsuMap):
    pkg = SvPkg([])

    for off0, off1 in zip(offsets[:-1], offsets[1:]):
        diff = off1 - off0
        pkg.append(SvSequence([(off0, diff * REF_BPM * 1.1),
                               (off0 + 1, MIN_BPM),
                               (off1, REF_BPM)]))

    m.bpms.extend(pkg.combine(SvPkg.CombineMethod.DROP_BY_POINT,
                              combineMethodWindow=0, combinePriorityLast=False).writeAsBpm(OsuBpm))
